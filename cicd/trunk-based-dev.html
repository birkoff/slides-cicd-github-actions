<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Scaled Trunk-Based Development</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/theme/white.css" id="theme">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">

    <style>
        /* Custom tweaks for that "GitHub Readme" feel */
        .reveal h1, .reveal h2, .reveal h3 { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; text-transform: none; }
        .reveal p, .reveal ul { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; color: #24292e; }
        .reveal code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }

        /* Code block styling to look like a terminal/editor */
        .reveal pre { box-shadow: 0 5px 15px rgba(0,0,0,0.15); border-radius: 6px; }
        .reveal pre code { padding: 20px; max-height: 500px; font-size: 1.1em; line-height: 1.3; }

        /* Helper for red/green text */
        .text-danger { color: #cb2431; }
        .text-success { color: #28a745; }
        .text-muted { color: #6a737d; font-size: 0.6em; }
    </style>
</head>

<body>
<div class="reveal">
    <div class="slides">

        <section>
        <h2>Scaled Trunk-Based Development</h2>
        <h3>with Rebase Workflow</h3>
        <p>
            <small>Date: 2024-05-20 &bull; Status: <span class="text-success">Accepted</span></small>
        </p>
        <p class="text-muted">Context: Development Team, DevOps</p>
    </section>

        <section>
            <h3>1. The Problem</h3>
            <p>Our current "GitFlow" strategy is causing:</p>
            <ul>
                <li class="fragment"><strong>Code Loss:</strong> Valid changes overwritten during complex merges.</li>
                <li class="fragment"><strong>Integration Hell:</strong> Spending days resolving conflicts, not coding.</li>
                <li class="fragment"><strong>Branch Sprawl:</strong> A "spaghetti" git graph that is impossible to read.</li>
            </ul>
        </section>

        <section>
            <h3>2. The Decision</h3>
            <p>We are adopting a <strong>Rebase-then-Merge</strong> policy.</p>
            <div style="text-align: left; background: #f6f8fa; padding: 20px; border-radius: 5px; font-size: 0.8em;">
                <p><strong>âœ… Primary Branch:</strong> <code>main</code> (Single source of truth)</p>
                <p><strong>âœ… Feature Branches:</strong> Short-lived (2-3 days max)</p>
                <p><strong>âœ… Conflicts:</strong> Resolved daily via <code>rebase</code></p>
                <p><strong>âœ… Merging:</strong> <code>--no-ff</code> to keep history bubbles</p>
            </div>
        </section>

        <section>
            <h3>3. Workflow: Start Ticket</h3>
            <p>Features must start from the latest stable code.</p>
            <pre><code class="language-bash" data-trim>
# 1. Update local main
git checkout main
git pull origin main

# 2. Create feature branch
git checkout -b JNET-123-ticket-branch
            </code></pre>
        </section>

        <section>
            <h3>3. Workflow: Sync (Daily)</h3>
            <p>Prevent "Branch Hell" by syncing daily.</p>
            <pre><code class="language-bash" data-trim data-line-numbers="1|3-4|6-7">
git fetch origin main

# Replay your work on top of latest main
git rebase origin/main

# Update remote (Lease protects overwrites)
git push origin --force-with-lease
            </code></pre>
        </section>

        <section>
            <h3>3. Workflow: PR & Merge</h3>
            <p>The merge creates a visual "bubble" in the history.</p>
            <pre><code class="language-bash" data-trim data-line-numbers="1-4|6-8">
# Create PR via CLI
gh pr create --base main \
             --head JNET-123-ticket-branch \
             --title "ðŸš€ Release $(date +%F)"

# Merge preserving history bubble
gh pr merge --merge
            </code></pre>
        </section>

        <section>
            <h3>4. Release Strategy</h3>
            <p>We decouple <em>Merge</em> from <em>Release</em>.</p>

            <div class="r-stack">
                <div class="fragment fade-out" data-fragment-index="0">
                    <p><strong>Phase A: Auto-Staging</strong></p>
                    <p>Merge to Main &rarr; <span class="text-success">Auto-Deploy to Staging</span></p>
                </div>
                <div class="fragment current-visible" data-fragment-index="0">
                    <p><strong>Phase B: "Create Release"</strong></p>
                    <ol style="font-size: 0.8em;">
                        <li>Trigger "Create Release" Workflow</li>
                        <li>System tags commit (v1.2.0)</li>
                        <li>Deploys to <strong>Prod Preview</strong></li>
                        <li>Promotes to <strong>Prod Live</strong></li>
                    </ol>
                </div>
            </div>
        </section>

        <section>
            <h3>5. Hotfix Strategy</h3>
            <p>Do not wait for the next full release.</p>
            <pre><code class="language-bash" data-trim data-line-numbers="1-2|4-5">
# 1. Target the release branch
git checkout release/v1.2.0

# 2. Apply fix & push (Triggers Prod Deploy)
git commit -m "FIX: Critical bug JNET-999"
git push origin release/v1.2.0
            </code></pre>
        </section>

        <section>
            <h3>Critical: Back-Port to Main</h3>
            <p>Ensure the fix doesn't disappear in v1.3.0.</p>
            <pre><code class="language-bash" data-trim>
git checkout main

# Cherry-pick the fix hash
git cherry-pick <commit-hash-of-fix>

git push origin main
            </code></pre>
        </section>

        <section>
            <h3>6. Consequences</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h4 class="text-success">Positive</h4>
                    <ul style="font-size: 0.6em;">
                        <li>Production Stability</li>
                        <li>No "Big Bang" Merges</li>
                        <li>Readable History</li>
                        <li>Automated Safety</li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-danger">Risks</h4>
                    <ul style="font-size: 0.6em;">
                        <li>Requires Rebase Discipline</li>
                        <li>Higher CI Load</li>
                    </ul>
                </div>
            </div>
        </section>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/plugin/highlight/highlight.js"></script>
<script>
	Reveal.initialize({
		hash: true,
		// Learn more about plugins: https://revealjs.com/plugins/
		plugins: [ RevealHighlight ]
	});
</script>
</body>
</html>
